(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{4202:function(e,t,s){Promise.resolve().then(s.bind(s,3307))},3307:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return R}});var a=s(7437),n=s(2265),r=s(9376),i=s(9064),d=s(6070),o=s(2869),l=s(8680),c=s(3464),m=s(4098),u=s(2489),p=s(4508);let x=m.fC,f=m.xz,g=m.h_;m.x8;let h=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(m.aV,{ref:t,className:(0,p.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n})});h.displayName=m.aV.displayName;let y=n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e;return(0,a.jsxs)(g,{children:[(0,a.jsx)(h,{}),(0,a.jsxs)(m.VY,{ref:t,className:(0,p.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r,children:[n,(0,a.jsxs)(m.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});y.displayName=m.VY.displayName;let b=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,p.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};b.displayName="DialogHeader";let j=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(m.Dx,{ref:t,className:(0,p.cn)("text-lg font-semibold leading-none tracking-tight",s),...n})});j.displayName=m.Dx.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(m.dk,{ref:t,className:(0,p.cn)("text-sm text-muted-foreground",s),...n})}).displayName=m.dk.displayName;var N=s(6818),v=s(1817);c.Z.defaults.baseURL="https://service-backend-orkd.onrender.com";let k=(0,l.ZP)("https://service-backend-orkd.onrender.com");function w(){let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(!0),[l,m]=(0,n.useState)(""),[u,p]=(0,n.useState)(!1),[g,h]=(0,n.useState)(null);(0,n.useEffect)(()=>(k.on("newBooking",e=>{i.Am.success("New booking received from ".concat(e.notification.email)),w()}),k.on("bookingRemoved",e=>{t(t=>t.filter(t=>t._id!==e.bookingId)),i.Am.success("Completed booking has been archived")}),w(),()=>{k.off("newBooking"),k.off("bookingRemoved"),k.disconnect()}),[]);let w=async()=>{try{let e=await c.Z.get("/api/admin/bookings");e.data.success&&t(e.data.bookings)}catch(e){console.error("Error fetching bookings:",e),i.Am.error("Failed to load bookings")}finally{r(!1)}},R=async(e,t)=>{h(e);try{(await c.Z.put("/api/bookings/".concat(e,"/status"),{status:t})).data.success&&(k.emit("bookingStatusUpdate",{bookingId:e,status:t}),"rejected"===t?i.Am.success("Booking rejected and customer notified via email"):i.Am.success("Booking ".concat(t," successfully")),"completed"===t&&await _(e),w())}catch(e){console.error("Error updating booking status:",e),i.Am.error("Failed to update booking status")}finally{h(null)}},_=async e=>{try{await c.Z.post("/api/bookings/".concat(e,"/schedule-removal"))}catch(e){console.error("Error scheduling booking removal:",e)}},S=async(e,t)=>{try{(await c.Z.put("/api/bookings/".concat(e,"/payment-status"),{paymentStatus:t})).data.success&&(k.emit("paymentStatusUpdate",{bookingId:e,paymentStatus:t}),i.Am.success("Payment status updated to ".concat(t)),w())}catch(e){console.error("Error updating payment status:",e),i.Am.error("Failed to update payment status")}},C=async e=>{if(!l.trim()){i.Am.error("Please enter a reply message");return}p(!0);try{let s=await c.Z.post("https://service-backend-orkd.onrender.com/api/admin/bookings/".concat(e,"/reply"),{reply:l,bookingId:e});if(s.data.success)t(t=>t.map(t=>t._id===e?{...t,adminReply:l}:t)),k.emit("adminReply",{bookingId:e,reply:l}),i.Am.success("Reply sent successfully"),m("");else throw Error(s.data.message||"Failed to send reply")}catch(e){var s,a;console.error("Reply error:",e),i.Am.error((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to send reply")}finally{p(!1)}};return((0,n.useEffect)(()=>(k.on("adminReplyUpdate",e=>{t(t=>t.map(t=>t._id===e.bookingId?{...t,adminReply:e.reply}:t))}),()=>{k.off("adminReplyUpdate")}),[]),s)?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsx)("div",{className:"space-y-4",children:0===e.length?(0,a.jsx)("p",{children:"No bookings found"}):e.map(e=>(0,a.jsx)(d.Zb,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold",children:["Customer: ",e.customerName]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Email: ",e.customerEmail]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Phone: ",e.customerPhone]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Address: ",e.address]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Pincode: ",e.pincode]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Scheduled: ",new Date(e.scheduledDate).toLocaleDateString()," at ",e.scheduledTime]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Payment Method: ",e.paymentMethod]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm",children:["Booking ID: ",e._id]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Booked on: ",new Date(e.createdAt).toLocaleDateString()]})]})]}),(0,a.jsxs)("div",{className:"mt-2 border-t pt-2",children:[(0,a.jsx)("h4",{className:"font-medium mb-1",children:"Services:"}),e.services.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsxs)("span",{children:[e.serviceName," x",e.quantity]}),(0,a.jsxs)("span",{children:["₹",e.totalPrice]})]},t)),(0,a.jsxs)("div",{className:"border-t mt-2 pt-2 font-semibold flex justify-between",children:[(0,a.jsx)("span",{children:"Total Amount:"}),(0,a.jsxs)("span",{children:["₹",e.totalAmount]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-2",children:[(0,a.jsxs)("p",{className:"text-sm ".concat("completed"===e.status?"text-green-600":"pending"===e.status?"text-yellow-600":"text-red-600"),children:["Status: ",e.status]}),(0,a.jsxs)("p",{className:"text-sm ".concat("completed"===e.paymentStatus?"text-green-600":"pending"===e.paymentStatus?"text-yellow-600":"text-red-600"),children:["Payment: ",e.paymentStatus]})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-4 border-t pt-4",children:[(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)(o.z,{onClick:()=>R(e._id,"accepted"),disabled:"pending"!==e.status||g===e._id,className:"".concat("accepted"===e.status?"bg-green-600":"bg-blue-600"," text-white px-4 py-2 rounded"),children:g===e._id?(0,a.jsx)(v.Z,{className:"h-4 w-4 animate-spin"}):"Accept"}),(0,a.jsx)(o.z,{onClick:()=>R(e._id,"rejected"),disabled:"pending"!==e.status||g===e._id,className:"bg-red-600 text-white px-4 py-2 rounded",children:g===e._id?(0,a.jsx)(v.Z,{className:"h-4 w-4 animate-spin"}):"Reject"}),(0,a.jsx)(o.z,{onClick:()=>R(e._id,"completed"),disabled:"accepted"!==e.status||g===e._id,className:"bg-green-600 text-white px-4 py-2 rounded",children:g===e._id?(0,a.jsx)(v.Z,{className:"h-4 w-4 animate-spin"}):"Complete"}),(0,a.jsxs)(x,{children:[(0,a.jsx)(f,{asChild:!0,children:(0,a.jsx)(o.z,{variant:"outline",className:"ml-2",children:e.adminReply?"Update Reply":"Reply to Customer"})}),(0,a.jsxs)(y,{children:[(0,a.jsx)(b,{children:(0,a.jsxs)(j,{children:["Reply to Booking #",e._id]})}),(0,a.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Your Reply"}),(0,a.jsx)(N.g,{value:l,onChange:e=>m(e.target.value),placeholder:"Enter your reply to the customer...",className:"min-h-[100px]"})]}),(0,a.jsx)(o.z,{onClick:()=>C(e._id),disabled:u||!l.trim(),className:"w-full",children:u?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 animate-spin"}),(0,a.jsx)("span",{children:"Sending..."})]}):"Send Reply"})]})]})]})]}),e.adminReply&&(0,a.jsxs)("div",{className:"mt-2 bg-gray-50 p-3 rounded-md",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Previous Reply:"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.adminReply})]}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)(o.z,{onClick:()=>S(e._id,"completed"),disabled:"completed"===e.paymentStatus,className:"bg-green-600 text-white px-4 py-2 rounded",children:"Mark Paid"}),(0,a.jsx)(o.z,{onClick:()=>S(e._id,"pending"),disabled:"pending"===e.paymentStatus,className:"bg-yellow-600 text-white px-4 py-2 rounded",children:"Mark Pending"})]})]})]})},e._id))})}function R(){let e=(0,r.useRouter)(),[t,s]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{(()=>{let t=localStorage.getItem("userData");if(!t){i.Am.error("Please login first"),e.push("/");return}let{email:a}=JSON.parse(t);if("kumarraushan04702@gmail.com"!==a){i.Am.error("Unauthorized access"),e.push("/");return}s(!0)})()},[e]),t)?(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Admin Dashboard"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Recent Bookings"}),(0,a.jsx)(w,{})]})})]}):null}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return l}});var a=s(7437),n=s(2265),r=s(7495),i=s(535),d=s(4508);let o=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=n.forwardRef((e,t)=>{let{className:s,variant:n,size:i,asChild:l=!1,...c}=e,m=l?r.g7:"button";return(0,a.jsx)(m,{className:(0,d.cn)(o({variant:n,size:i,className:s})),ref:t,...c})});l.displayName="Button"},6070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return d},SZ:function(){return l},Zb:function(){return i},aY:function(){return c},ll:function(){return o}});var a=s(7437),n=s(2265),r=s(4508);let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});i.displayName="Card";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",s),...n})});d.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});o.displayName="CardTitle";let l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",s),...n})});l.displayName="CardDescription";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",s),...n})});c.displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter"},6818:function(e,t,s){"use strict";s.d(t,{g:function(){return i}});var a=s(7437),n=s(2265),r=s(4508);let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});i.displayName="Textarea"},4508:function(e,t,s){"use strict";s.d(t,{cn:function(){return r}});var a=s(1994),n=s(3335);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,a.W)(t))}},1817:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[137,64,464,444,986,680,971,117,744],function(){return e(e.s=4202)}),_N_E=e.O()}]);