(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[926],{2342:function(e,t,a){Promise.resolve().then(a.bind(a,6835))},6835:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return S}});var s,r=a(7437),n=a(2265),i=a(3464),l=a(6070),d=a(9064),c=a(9376),o=a(8680),u="https://js.stripe.com/v3",m=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,p=function(){for(var e=document.querySelectorAll('script[src^="'.concat(u,'"]')),t=0;t<e.length;t++){var a=e[t];if(m.test(a.src))return a}return null},f=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",a=document.createElement("script");a.src="".concat(u).concat(t);var s=document.head||document.body;if(!s)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(a),a},x=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"5.5.0",startTime:t})},h=null,y=null,v=null,g=function(e,t,a){if(null===e)return null;var s=e.apply(void 0,t);return x(s,a),s},b=!1,j=function(){return s||(s=(null!==h?h:(h=new Promise(function(e,t){if("undefined"==typeof window||"undefined"==typeof document){e(null);return}if(window.Stripe,window.Stripe){e(window.Stripe);return}try{var a,s=p();s?s&&null!==v&&null!==y&&(s.removeEventListener("load",v),s.removeEventListener("error",y),null===(a=s.parentNode)||void 0===a||a.removeChild(s),s=f(null)):s=f(null),v=function(){window.Stripe?e(window.Stripe):t(Error("Stripe.js not available"))},y=function(){t(Error("Failed to load Stripe.js"))},s.addEventListener("load",v),s.addEventListener("error",y)}catch(e){t(e);return}})).catch(function(e){return h=null,Promise.reject(e)})).catch(function(e){return s=null,Promise.reject(e)}))};Promise.resolve().then(function(){return j()}).catch(function(e){b||console.warn(e)});var N=a(257);i.Z.defaults.baseURL="https://service-backend-orkd.onrender.com";let w=(0,o.ZP)("https://service-backend-orkd.onrender.com"),k=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];b=!0;var s=Date.now();return j().then(function(e){return g(e,t,s)})}(N.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);function S(){let e=(0,c.useRouter)(),[t,a]=(0,n.useState)([]),[s,o]=(0,n.useState)(!0),[u,m]=(0,n.useState)(!1),[p,f]=(0,n.useState)(null),[x,h]=(0,n.useState)({});(0,n.useEffect)(()=>{let t=async()=>{try{let t=localStorage.getItem("userData");if(!t){d.Am.error("Please login to view bookings"),e.push("/login");return}let s=JSON.parse(t).email;if(!s){d.Am.error("User email not found"),e.push("/login");return}let r=await i.Z.get("/api/bookings/".concat(s));r.data.success&&a(r.data.bookings)}catch(e){console.error("Error fetching bookings:",e),d.Am.error("Failed to load bookings")}finally{o(!1)}};return w.on("newBooking",e=>{t(),d.Am.success("New booking created!")}),w.on("bookingStatusUpdate",e=>{a(t=>t.map(t=>t._id===e.bookingId?{...t,status:e.status}:t));let t={accepted:"Your booking has been accepted!",rejected:"Sorry, technician is not available at this time. Please try booking for a different time slot.",completed:"Your service has been completed!"};"rejected"===e.status?d.Am.error(t.rejected):d.Am.success(t[e.status]||"Booking status updated to ".concat(e.status))}),w.on("paymentStatusUpdate",e=>{a(t=>t.map(t=>t._id===e.bookingId?{...t,paymentStatus:e.paymentStatus}:t)),(0,d.Am)({completed:"Payment has been marked as completed!",pending:"Payment has been marked as pending.",failed:"Payment has been marked as failed."}[e.paymentStatus]||"Payment status updated to ".concat(e.paymentStatus))}),t(),()=>{w.off("newBooking"),w.off("bookingStatusUpdate"),w.off("paymentStatusUpdate"),w.disconnect()}},[e]);let y=async()=>{if(p&&x.upiId)try{(await i.Z.post("/api/payments/upi/".concat(p._id),{upiId:x.upiId})).data.success&&(d.Am.success("UPI payment initiated"),m(!1))}catch(e){d.Am.error("UPI payment failed")}},v=async()=>{if(p)try{let e=await k;if(!e)throw Error("Stripe failed to initialize");let{paymentMethod:t}=await e.createPaymentMethod({type:"card",card:{token:x.cardNumber}});if(!t)throw Error("Failed to create payment method");let{clientSecret:a}=(await i.Z.post("/api/payments/create-intent/".concat(p._id))).data,s=await e.confirmCardPayment(a,{payment_method:t.id});if(s.error)throw Error(s.error.message);"succeeded"===s.paymentIntent.status&&(d.Am.success("Payment successful"),m(!1))}catch(e){d.Am.error(e.message||"Payment failed")}};return s?(0,r.jsxs)("div",{className:"container mx-auto p-4",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded-md w-48 mb-6 animate-pulse"}),(0,r.jsx)("div",{className:"flex justify-center space-x-2 mb-8",children:[void 0,void 0,void 0].map((e,t)=>(0,r.jsx)("div",{className:"w-3 h-3 bg-primary rounded-full animate-bounce",style:{animationDelay:"".concat(.2*t,"s")}},t))}),(0,r.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,r.jsx)(l.Zb,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"space-y-3 flex-1",children:[(0,r.jsx)("div",{className:"h-5 bg-gray-200 rounded w-48 animate-pulse"}),(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsx)("div",{className:"h-4 bg-gray-100 rounded w-3/4 animate-pulse"},t))}),(0,r.jsx)("div",{className:"mt-4 space-y-2",children:[void 0,void 0].map((e,t)=>(0,r.jsx)("div",{className:"h-4 bg-gray-100 rounded w-1/2 animate-pulse"},t))})]}),(0,r.jsxs)("div",{className:"text-right space-y-3",children:[(0,r.jsx)("div",{className:"h-5 bg-gray-200 rounded w-24 ml-auto animate-pulse"}),(0,r.jsx)("div",{className:"h-4 bg-gray-100 rounded w-20 ml-auto animate-pulse"}),(0,r.jsx)("div",{className:"h-4 bg-gray-100 rounded w-28 ml-auto animate-pulse"})]})]})},t))})]}):(0,r.jsxs)("div",{className:"container mx-auto p-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"My Bookings"}),(0,r.jsx)("div",{className:"space-y-4",children:0===t.length?(0,r.jsx)("p",{children:"No bookings found"}):t.map(e=>(0,r.jsxs)(l.Zb,{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-semibold",children:["Booking ID: ",e._id]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Booked on: ",new Date(e.createdAt).toLocaleDateString()]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Scheduled: ",new Date(e.scheduledDate).toLocaleDateString()," at ",e.scheduledTime]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Address: ",e.address]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Pincode: ",e.pincode]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Payment Method: ",e.paymentMethod]}),(0,r.jsx)("div",{className:"mt-2",children:e.services.map((e,t)=>(0,r.jsxs)("div",{className:"text-sm",children:[e.serviceName," x",e.quantity," - ₹",e.totalPrice]},t))})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"font-semibold",children:["Total: ₹",e.totalAmount]}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsxs)("p",{className:"text-sm ".concat("completed"===e.status?"text-green-600":"accepted"===e.status?"text-blue-600":"rejected"===e.status?"text-red-600":"text-yellow-600"),children:["Status: ","rejected"===e.status?"Technician not available":e.status]}),"rejected"===e.status&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Please try booking for a different time slot"})]}),(0,r.jsxs)("p",{className:"text-sm ".concat("completed"===e.paymentStatus?"text-green-600":"pending"===e.paymentStatus?"text-yellow-600":"text-red-600"),children:["Payment: ",e.paymentStatus]})]})]}),e.adminReply&&(0,r.jsxs)("div",{className:"mt-4 bg-blue-50 p-4 rounded-md w-full",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-blue-800 mb-2",children:"Message from Service Provider:"}),(0,r.jsx)("p",{className:"text-sm text-gray-700",children:e.adminReply})]})]},e._id))}),u&&p&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,r.jsxs)(l.Zb,{className:"p-6 w-full max-w-md",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold mb-4",children:["Payment for Booking ",p._id]}),"upi"===p.paymentMethod?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"UPI ID"}),(0,r.jsx)("input",{type:"text",className:"w-full p-2 border rounded",placeholder:"Enter UPI ID",onChange:e=>h({upiId:e.target.value})})]}),(0,r.jsx)("button",{className:"w-full bg-primary text-white p-2 rounded",onClick:y,children:"Pay with UPI"})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Card Number"}),(0,r.jsx)("input",{type:"text",className:"w-full p-2 border rounded",placeholder:"Card number",onChange:e=>h(t=>({...t,cardNumber:e.target.value}))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Expiry Date"}),(0,r.jsx)("input",{type:"text",className:"w-full p-2 border rounded",placeholder:"MM/YY",onChange:e=>h(t=>({...t,expiryDate:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"CVV"}),(0,r.jsx)("input",{type:"text",className:"w-full p-2 border rounded",placeholder:"CVV",onChange:e=>h(t=>({...t,cvv:e.target.value}))})]})]}),(0,r.jsx)("button",{className:"w-full bg-primary text-white p-2 rounded",onClick:v,children:"Pay with Card"})]}),(0,r.jsx)("button",{className:"w-full mt-4 bg-gray-200 p-2 rounded",onClick:()=>m(!1),children:"Cancel"})]})})]})}},6070:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return o},ll:function(){return d}});var s=a(7437),r=a(2265),n=a(4508);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});i.displayName="Card";let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})});l.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});d.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});c.displayName="CardDescription";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...r})});o.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},4508:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var s=a(1994),r=a(3335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[137,64,464,680,971,117,744],function(){return e(e.s=2342)}),_N_E=e.O()}]);